# 第一天实操练习指南

## 练习1：环境搭建与Hello World

### 目标
完成n8n环境搭建，创建第一个工作流

### 步骤

#### 1.1 Docker环境搭建
```bash
# 创建n8n数据目录
mkdir -p ~/.n8n

# 启动n8n容器
docker run -it --rm \
  --name n8n \
  -p 5678:5678 \
  -v ~/.n8n:/home/node/.n8n \
  n8nio/n8n

# 访问n8n界面
# 打开浏览器访问：http://localhost:5678
```

#### 1.2 创建Hello World工作流

**步骤：**
1. 点击"New Workflow"
2. 添加Manual Trigger节点
3. 添加Set节点，配置如下：
   ```json
   {
     "message": "Hello from n8n!",
     "timestamp": "{{ $now }}",
     "user": "{{ $json.user || 'Anonymous' }}"
   }
   ```
4. 添加HTTP Request节点，配置：
   - Method: POST
   - URL: https://webhook.site/your-unique-url
   - Body: `{{ $json }}`

**测试：**
1. 点击Manual Trigger节点
2. 在测试面板输入：`{"user": "张三"}`
3. 点击"Test step"
4. 检查webhook.site是否收到数据

### 练习2：天气查询工作流

#### 目标
创建一个天气查询工作流，通过城市名获取天气信息

#### 实现步骤

**2.1 获取OpenWeatherMap API Key**
1. 访问：https://openweathermap.org/api
2. 注册账号并获取免费API Key

**2.2 创建工作流**
1. Manual Trigger节点
2. Set节点（设置城市和API Key）：
   ```json
   {
     "city": "{{ $json.city || 'Beijing' }}",
     "apiKey": "your_api_key_here"
   }
   ```
3. Code节点（构建API URL）：
   ```javascript
   const city = $input.first().json.city;
   const apiKey = $input.first().json.apiKey;
   const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=zh_cn`;
   
   return [{json: {url, city}}];
   ```
4. HTTP Request节点：
   - Method: GET
   - URL: `{{ $json.url }}`
5. Set节点（格式化天气数据）：
   ```javascript
   const weather = $input.first().json;
   
   return [{
     json: {
       city: weather.name,
       temperature: `${weather.main.temp}°C`,
       description: weather.weather[0].description,
       humidity: `${weather.main.humidity}%`,
       windSpeed: `${weather.wind.speed} m/s`,
       timestamp: new Date().toISOString()
     }
   }];
   ```

**2.3 测试工作流**
输入测试数据：
```json
{
  "city": "Shanghai"
}
```

### 练习3：数据验证与错误处理

#### 目标
创建一个用户数据验证工作流，包含错误处理机制

#### 实现步骤

**3.1 创建验证工作流**
1. Manual Trigger节点
2. Code节点（数据验证）：
   ```javascript
   const userData = $input.first().json;
   const errors = [];
   
   // 验证必填字段
   if (!userData.name || userData.name.trim() === '') {
     errors.push('姓名不能为空');
   }
   
   if (!userData.email || userData.email.trim() === '') {
     errors.push('邮箱不能为空');
   } else {
     // 验证邮箱格式
     const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
     if (!emailRegex.test(userData.email)) {
       errors.push('邮箱格式不正确');
     }
   }
   
   if (!userData.age || userData.age < 0 || userData.age > 150) {
     errors.push('年龄必须在0-150之间');
   }
   
   const isValid = errors.length === 0;
   
   return [{
     json: {
       userData,
       isValid,
       errors,
       validatedAt: new Date().toISOString()
     }
   }];
   ```
3. IF节点（条件判断）：
   - 条件：`{{ $json.isValid === true }}`
4. Set节点（成功处理）：
   ```json
   {
     "status": "success",
     "message": "数据验证通过",
     "user": "{{ $('Code').item.json.userData }}"
   }
   ```
5. Set节点（错误处理）：
   ```json
   {
     "status": "error",
     "message": "数据验证失败",
     "errors": "{{ $('Code').item.json.errors }}"
   }
   ```

**3.2 测试用例**
```json
// 有效数据
{
  "name": "张三",
  "email": "zhangsan@example.com",
  "age": 25
}

// 无效数据
{
  "name": "",
  "email": "invalid-email",
  "age": -5
}
```

## 练习4：条件分支处理

#### 目标
创建一个订单处理工作流，根据订单金额进行不同处理

#### 实现步骤

**4.1 创建订单处理工作流**
1. Manual Trigger节点
2. Set节点（订单数据）：
   ```json
   {
     "orderId": "{{ $json.orderId || 'ORD-001' }}",
     "amount": "{{ $json.amount || 100 }}",
     "customerType": "{{ $json.customerType || 'regular' }}"
   }
   ```
3. Switch节点（金额分类）：
   - 规则1：`{{ $json.amount < 100 }}` → 小额订单
   - 规则2：`{{ $json.amount >= 100 && $json.amount < 1000 }}` → 中额订单
   - 规则3：`{{ $json.amount >= 1000 }}` → 大额订单
4. 为每个分支添加Set节点：
   ```javascript
   // 小额订单处理
   const order = $input.first().json;
   return [{
     json: {
       orderId: order.orderId,
       amount: order.amount,
       processType: '小额订单',
       discount: 0,
       priority: 'normal',
       estimatedTime: '1-2天'
     }
   }];
   ```

**4.2 测试不同场景**
```json
// 小额订单
{
  "orderId": "ORD-001",
  "amount": 50,
  "customerType": "regular"
}

// 大额订单
{
  "orderId": "ORD-002",
  "amount": 1500,
  "customerType": "vip"
}
```

## 练习总结

### 学习要点
1. **环境搭建**：掌握Docker部署n8n的方法
2. **基础节点**：熟练使用Manual Trigger、Set、HTTP Request、Code节点
3. **数据流转**：理解JSON数据在工作流中的传递
4. **条件判断**：掌握IF和Switch节点的使用
5. **错误处理**：学会数据验证和异常处理

### 常见问题
1. **Docker端口冲突**：修改端口映射 `-p 5679:5678`
2. **API调用失败**：检查网络连接和API Key
3. **数据格式错误**：使用JSON验证工具检查数据格式
4. **节点配置错误**：仔细检查节点参数和表达式语法

### 扩展练习
1. 尝试添加更多节点类型
2. 实现更复杂的数据转换逻辑
3. 集成其他公开API
4. 添加日志记录功能 